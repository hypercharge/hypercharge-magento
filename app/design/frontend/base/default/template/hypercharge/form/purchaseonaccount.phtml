<?php/** * Magento * * NOTICE OF LICENSE * * This source file is subject to the Academic Free License (AFL 3.0) * that is bundled with this package in the file LICENSE_AFL.txt. * It is also available through the world-wide-web at this URL: * http://opensource.org/licenses/afl-3.0.php * If you did not receive a copy of the license and are unable to * obtain it through the world-wide-web, please send an email * to license@magentocommerce.com so we can send you a copy immediately. * * DISCLAIMER * * Do not edit or add to this file if you wish to upgrade Magento to newer * versions in the future. If you wish to customize Magento for your * needs please refer to http://www.magentocommerce.com for more information. * * @category    Mage * @package     GlobalExperts_Hypercharge * @copyright   Copyright (c) 2014 Global Experts GmbH (http://www.globalexperts.ch/) * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0) */$_code=$this->getMethodCode();$quote = Mage::getSingleton('checkout/session')->getQuote();$billing = $quote->getBillingAddress();$jsonShippingAddress = '"shipping_address":{';$jsonShippingAddress .= '"first_name":"' . $billing->getFirstname() . '",';$jsonShippingAddress .= '"last_name":"' . $billing->getLastname() . '",';$jsonShippingAddress .= '"address1":"' . $billing->getStreet(1) . '",';$jsonShippingAddress .= '"zip_code":"' . $billing->getPostcode() . '",';$jsonShippingAddress .= '"city":"' . $billing->getCity() . '",';$jsonShippingAddress .= '"state":"' . $billing->getRegionCode() . '",';$jsonShippingAddress .= '"country":"' . $billing->getCountry() . '"';$jsonShippingAddress .= '},';if (!$quote->isVirtual()) {    $shipping = $quote->getShippingAddress();    $sameAddresses = Mage::helper('bithypercharge')->checkAddresses($billing, $shipping);} else {    $sameAddresses = true;}$isRequiredDob = Mage::getStoreConfig("payment/". $_code . "/requiredob");?><?php if ($sameAddresses): ?><ul class="form-list" id="payment_form_<?php echo $_code ?>" style="display:none;">    <?php if ($isRequiredDob): ?>        <li>            <label for="poa-month">Date of Birth</label>            <div class="input-box customer-dob stdpoa-dob">                <div class="dob-day">                    <input type="hidden" id="stdpoa-day" value="1" title="<?php echo $this->__('Day'); ?>" class="input-text validate-custom" />                    <select id="stdpoa-day-select" onchange="updateInput('stdpoa-day-select','stdpoa-day')" value="" title="<?php echo $this->__('Day'); ?>" class="">                        <?php for ($i=1; $i<=31; $i++) { ?>                            <option value="<?php echo $i; ?>"><?php echo $i; ?></option>                        <?php }?>                    </select>                    <label for="stdpoa-day"><?php echo $this->__('DD'); ?></label>                </div>                <div class="dob-month">                    <input type="hidden" id="stdpoa-month" value="1" title="<?php echo $this->__('Month'); ?>" class="input-text validate-custom" />                    <select id="stdpoa-month-select" onchange="updateInput('stdpoa-month-select','stdpoa-month')" value="" title="<?php echo $this->__('Month'); ?>" class="">                        <?php for ($i=1; $i<=12; $i++) { ?>                            <option value="<?php echo $i; ?>"><?php echo $i; ?></option>                        <?php }?>                    </select>                    <label for="<?php echo $this->getFieldId('month'); ?>"><?php echo $this->__('MM'); ?></label>                </div>                <div class="dob-year">                    <?php $year = date('Y'); ?>                    <input type="hidden" id="stdpoa-year" value="<?php echo $year; ?>" title="<?php echo $this->__('Year'); ?>" class="input-text validate-custom" />                    <select id="stdpoa-year-select" onchange="updateInput('stdpoa-year-select','stdpoa-year')" value="" title="<?php echo $this->__('Year'); ?>" class="">                        <?php for ($i=$year; $i>=1900; $i--) { ?>                            <option value="<?php echo $i; ?>"><?php echo $i; ?></option>                        <?php }?>                    </select>                    <label for="<?php echo $this->getFieldId('year'); ?>"><?php echo $this->__('YYYY'); ?></label>                </div>                <div class="dob-full" style="">                    <input type="hidden" id="stdpoa-dob" class="input-text validate-stdpoa-age" />                </div>                <div class="validation-advice" style="display:none;"></div>            </div>        </li>    <?php endif; ?></ul><?php else: ?>    <ul class="form-list">        <li class="notice">            <?php echo Mage::helper('bithypercharge')->__('For this payment method the shipping address must be the same as billing address.'); ?>        </li>    </ul>    <script type="text/javascript">        //<![CDATA[        var att=document.createAttribute("disabled");        att.value="disabled";        var paymentElem = document.getElementById('p_method_<?php echo $_code ?>');        paymentElem.setAttributeNode(att);        if (paymentElem.getAttribute("checked") == "checked") {            paymentElem.removeAttribute("checked");        }        //]]>    </script><?php endif; ?><script type="text/javascript">    //<![CDATA[    <?php if ($isRequiredDob) : ?>    var poa_dob = new Varien.DOB('.stdpoa-dob', true, '%Y-%m-%e');    <?php endif; ?>    var paymentElem = document.getElementById('p_method_<?php echo $_code ?>');    if(window.addEventListener) {        paymentElem.addEventListener('click', bindPaymentForm, false);    } else if (window.attachEvent){        paymentElem.attachEvent('onclick', bindPaymentForm);    }    function bindPaymentForm() {        if(document.getElementById('p_method_<?php echo $_code ?>').checked) {            // This one will bind our fields changes to the JS Object values            Hyper.getInstance().bindFields('payment_form_<?php echo $_code ?>');            // This one will set submit url from your payment method (getSubmit() method should be implemented on block level)            Hyper.getInstance().setSubmitUrl('<?php echo $this->getSubmitUrl();?>');            Hyper.getInstance().setShippingAddress('<?php echo $jsonShippingAddress; ?>');            Hyper.getInstance().setPaymentMethod('purchase_on_account');            Hyper.getInstance().setHeaderOrigin('<?php echo Mage::getBaseUrl('web') ?>');            Hyper.getInstance().setSuccessUrl('<?php echo Mage::getUrl('checkout/onepage/success'); ?>');            Hyper.getInstance().setErrorUrl('<?php echo Mage::getUrl('checkout/onepage/failure'); ?>');            Hyper.getInstance().setMode('<?php echo Mage::getStoreConfig('payment/' . $_code . '/test'); ?>');        }    }    //]]> </script>